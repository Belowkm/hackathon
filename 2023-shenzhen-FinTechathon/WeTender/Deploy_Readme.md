# 部署文件运行说明
本作品采用WeBase一键部署，详见：WeBase技术文档链接https://webasedoc.readthedocs.io/zh-cn/latest/docs/WeBASE/install.html。
## 修改配置（重要）
### 修改配置文件（``vi common.properties``）
一键部署支持使用已有链或者搭建新链。通过参数”if.exist.fisco”配置是否使用已有链，以下配置二选一即可：
- 当配置”yes”时，需配置已有链的路径``fisco.dir``。路径下要存在sdk目录，sdk目录中包含ca.crt, sdk.crt, sdk.key及gm目录，gm目录中包含国密SSL所需证书，包含gmca.crt、gmsdk.crt、gmsdk.key、gmensdk.crt和gmensdk.key
- 当配置”no”时，需配置节点fisco版本和节点安装个数，搭建的新链默认两个群组，建议搭建至少四个群组。
如果不使用一键部署搭建新链，可以参考FISCO BCOS官方文档搭建 FISCO BCOS部署流程。  
**注意：本作品建议使用国密版部署，故需要修改设置配置项``encrypt.type=1``，并修改设置配置项``encrypt.sslType=1``来使用使用国密SSL。**
## 访问
一键部署完成后，打开浏览器（Chrome Safari或Firefox），即可访问WeBase平台。（默认端口为5000）  
``http://{deployIP}:{webPort}``  
``示例：http://localhost:5000``    
## 部署流程
将Contract文件夹当中的所有合约导入“合约IDE”中并保存。
在“私钥管理”中创建至少两个用户。建议创建至少四个用户，分别为县级政府（``County_Gov``），乡级政府（``Town_Gov``），银行（``WeBank``），中标企业（``Enterprise``）。  
将``County_Gov``、``Town_Gov``、``Bank``、``Enterprise``的四个合约分别部署到``County_Gov``、``Town_Gov``、``WeBank``、``Enterprise``四个用户当中，输入指定参数即可。企业和银行用户的id，建议使用统一社会信用代码。  
* 县级政府可以通过使用``addTown``函数，将乡级政府的单位名称和用户地址导入到县级政府特有的乡级政府管理列表town_list中，方便后续管理。  
* 县乡政府的合约统一通过``Government``合约派生而来，故基本功能一致。  
## 交易环节
### 1.政府设置预算
- ``SetBal``：政府部门要设立当年的采购预算，方可进行立项和招标。
### 2.政府部门立项
- ``CreateProj``：政府部门立项，设立项目标签和项目预算等信息。项目编号建议由上级部门统一批复，防止出现同一个中标企业同时接到两个不同的工单但为同一个ProjectID的现象。
### 3.政府部门开标
- ``Deal``：政府部门通过额外输入中标企业用户地址，在项目中登记中标企业地址信息。值得一提的是，Project合约会自动将项目信息同步给中标企业。 
### 4.中标企业施工
- ``Build``：中标企业通过Build函数进行每天的项目施工进度汇报，并上报当日的成本预算。 
### 5.中标企业竣工 
- ``Finish``：中标企业在项目施工完毕后，通过Finish函数对项目进行项目完工的登记。
### 6.政府部门验收
- ``Pass``：政府部门在项目竣工状态之后，通过Pass函数对项目进行一个验收操作。验收可以请第三方检测公司进行检测，操作预算仍从总项目预算里面扣除。
### 7.投入使用和项目结算
- ``Work``和``Salary``：政府部门在项目通过验收之后，通过Work函数将项目进行投入使用的登记。项目若还有余款，则政府根据企业的信用评级，酌情考虑企业的利润分配情况，其余预算留在项目当中，留备后续修缮使用。Salary函数触发成功后，将自动触发Enterprise合约中的AddProfit函数，登记企业的利润情况。
### 8.道路修缮
- ``AfterMarket``：项目投入使用后，若发生不可抗力因素造成的项目损坏，政府部门通过调用AfterMarket函数对项目更改为维修状态，相关情况也会通过Project合约自动同步给中标企业。相关进度回到步骤4处进行新一轮施工、竣工、验收、投入使用和项目结算的流程。
### 9.银行的作用
- ``Bank``合约：为不违反比赛的游戏规则，我们作品中仅让银行承担了相关流水的记录功能。银行在收到政府对政府、政府对企业、企业对企业等的相关转账请求，完成实际具有法律效力的转账操作之后，再进行对流水信息的登记上链的操作。未来若进行实际落地应用，可联动数字人民币等合法合规的交易工具进行进一步开发，相关兼容性我们已预留。





